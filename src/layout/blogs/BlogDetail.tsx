import React, { useEffect, useState } from "react";
import { BlogListRecent } from "./Components/ComponentDEtail/BlogListRecent";
import { BlogSideBar } from "./Components/ComponentDEtail/BlogSideBar";
import { useParams } from "react-router-dom";
import { GET_USER_BLOG_DETAIL } from "../../api/api";
import "./detail_blog.css";
interface BlogModel {
  id: number;
  title: string;
  content: string;
  created_at: Date;
  updated_at: Date;
  author_id: number;
  cat_blog_id: number;
  status: true;
  image: string;
  author_name: string;
  category_name: string;
}

export const BlogDetail = () => {
  const { id } = useParams<{ id: string }>();
  const [blog, setBlog] = useState<BlogModel | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchBlog = async () => {
      try {
        const response = await fetch(GET_USER_BLOG_DETAIL(Number(id)));
        if (!response.ok) {
          throw new Error("Có lỗi xảy ra khi lấy dữ liệu blog");
        }
        const data = await response.json();
        setBlog(data);
        setLoading(false);
      } catch (err) {
        setError("Không thể lấy dữ liệu blog.");
        setLoading(false);
      }
    };

    fetchBlog();
  }, [id]);

  if (loading) {
    return <div>Đang tải dữ liệu...</div>;
  }

  if (error) {
    return <div>Lỗi: {error}</div>;
  }

  if (!blog) {
    return <div>Không tìm thấy blog</div>;
  }

  return (
    <section className="blog-detals-area  pb-120">
      <div className="container">
        <div className="row g-4">
          <div className="col-lg-8 order-2 order-lg-1">
            <div className="blog-details__item-left">
              <div className="title">
                <h3 style={{ textAlign: "left", fontSize: "32px" }}>
                  {blog.title}
                </h3>
              </div>
              <div className="image">
                <img src={blog.image} alt={blog.title}></img>
              </div>
              <ul className="info mt-40 pb-20 bor-bottom">
                <li>
                  <svg
                    className="me-1"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_1437_2716)">
                      <path
                        d="M14.5441 5.19275C14.5441 7.69093 12.4995 9.7355 10.0013 9.7355C7.50317 9.7355 5.45859 7.69093 5.45859 5.19275C5.45859 2.69457 7.50313 0.65 10.0013 0.65C12.4995 0.65 14.5441 2.69458 14.5441 5.19275Z"
                        stroke="#2EB97E"
                        stroke-width="1.3"
                      />
                      <path
                        d="M18.2631 14.6715C18.1039 14.9468 17.9228 15.2083 17.7156 15.4776L17.7155 15.4775L17.7076 15.4883C17.419 15.8798 17.0832 16.2383 16.7281 16.5934C16.4313 16.8902 16.0919 17.187 15.7554 17.4394C14.0781 18.692 12.0608 19.3508 9.97684 19.3508C7.89705 19.3508 5.88376 18.6948 4.20845 17.4471C3.84457 17.1514 3.51237 16.8802 3.22556 16.5934L3.21859 16.5864L3.21141 16.5797C2.85532 16.2445 2.54107 15.8886 2.24614 15.4883L2.24616 15.4883L2.24283 15.4839C2.06061 15.2409 1.8719 14.9765 1.71789 14.7179C1.83488 14.4568 1.98324 14.1857 2.1439 13.9536L2.14402 13.9537L2.15153 13.9423C3.06854 12.5566 4.53574 11.6398 6.16512 11.4157L6.18469 11.4131L6.20407 11.4092C6.22956 11.4041 6.29364 11.4126 6.34417 11.4505L6.34416 11.4505L6.34817 11.4535C7.4152 12.2411 8.68499 12.6463 9.99949 12.6463C11.314 12.6463 12.5838 12.2411 13.6508 11.4535L13.6508 11.4535L13.6548 11.4505C13.6702 11.439 13.739 11.4089 13.8479 11.4177C15.4675 11.6445 16.9108 12.5578 17.8511 13.9478L17.8511 13.9478L17.8551 13.9536C18.0152 14.1849 18.1543 14.4241 18.2631 14.6715Z"
                        stroke="#2EB97E"
                        stroke-width="1.3"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_1437_2716">
                        <rect width="20" height="20" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <a href="#0"> {blog.author_name}</a>
                </li>
                <li>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M6.66406 4.79102C6.3224 4.79102 6.03906 4.50768 6.03906 4.16602V1.66602C6.03906 1.32435 6.3224 1.04102 6.66406 1.04102C7.00573 1.04102 7.28906 1.32435 7.28906 1.66602V4.16602C7.28906 4.50768 7.00573 4.79102 6.66406 4.79102ZM13.3307 4.79102C12.9891 4.79102 12.7057 4.50768 12.7057 4.16602V1.66602C12.7057 1.32435 12.9891 1.04102 13.3307 1.04102C13.6724 1.04102 13.9557 1.32435 13.9557 1.66602V4.16602C13.9557 4.50768 13.6724 4.79102 13.3307 4.79102ZM7.08073 12.0827C6.9724 12.0827 6.86406 12.0577 6.76406 12.016C6.65573 11.9743 6.5724 11.916 6.48906 11.841C6.33906 11.6827 6.2474 11.4743 6.2474 11.2493C6.2474 11.141 6.2724 11.0327 6.31406 10.9327C6.35573 10.8327 6.41406 10.741 6.48906 10.6577C6.5724 10.5827 6.65573 10.5243 6.76406 10.4827C7.06406 10.3577 7.43906 10.4243 7.6724 10.6577C7.8224 10.816 7.91406 11.0327 7.91406 11.2493C7.91406 11.2993 7.90573 11.3577 7.8974 11.416C7.88906 11.466 7.8724 11.516 7.8474 11.566C7.83073 11.616 7.80573 11.666 7.7724 11.716C7.7474 11.7577 7.70573 11.7993 7.6724 11.841C7.51406 11.991 7.2974 12.0827 7.08073 12.0827ZM9.9974 12.0827C9.88906 12.0827 9.78073 12.0577 9.68073 12.016C9.5724 11.9743 9.48906 11.916 9.40573 11.841C9.25573 11.6827 9.16406 11.4743 9.16406 11.2493C9.16406 11.141 9.18906 11.0327 9.23073 10.9327C9.2724 10.8327 9.33073 10.741 9.40573 10.6577C9.48906 10.5827 9.5724 10.5243 9.68073 10.4827C9.98073 10.3493 10.3557 10.4243 10.5891 10.6577C10.7391 10.816 10.8307 11.0327 10.8307 11.2493C10.8307 11.2993 10.8224 11.3577 10.8141 11.416C10.8057 11.466 10.7891 11.516 10.7641 11.566C10.7474 11.616 10.7224 11.666 10.6891 11.716C10.6641 11.7577 10.6224 11.7993 10.5891 11.841C10.4307 11.991 10.2141 12.0827 9.9974 12.0827ZM12.9141 12.0827C12.8057 12.0827 12.6974 12.0577 12.5974 12.016C12.4891 11.9743 12.4057 11.916 12.3224 11.841L12.2224 11.716C12.1908 11.6696 12.1656 11.6191 12.1474 11.566C12.1233 11.5188 12.1065 11.4682 12.0974 11.416C12.0891 11.3577 12.0807 11.2993 12.0807 11.2493C12.0807 11.0327 12.1724 10.816 12.3224 10.6577C12.4057 10.5827 12.4891 10.5243 12.5974 10.4827C12.9057 10.3493 13.2724 10.4243 13.5057 10.6577C13.6557 10.816 13.7474 11.0327 13.7474 11.2493C13.7474 11.2993 13.7391 11.3577 13.7307 11.416C13.7224 11.466 13.7057 11.516 13.6807 11.566C13.6641 11.616 13.6391 11.666 13.6057 11.716C13.5807 11.7577 13.5391 11.7993 13.5057 11.841C13.3474 11.991 13.1307 12.0827 12.9141 12.0827ZM7.08073 14.9993C6.9724 14.9993 6.86406 14.9743 6.76406 14.9327C6.66406 14.891 6.5724 14.8327 6.48906 14.7577C6.33906 14.5993 6.2474 14.3827 6.2474 14.166C6.2474 14.0577 6.2724 13.9494 6.31406 13.8493C6.35573 13.741 6.41406 13.6494 6.48906 13.5744C6.7974 13.266 7.36406 13.266 7.6724 13.5744C7.8224 13.7327 7.91406 13.9493 7.91406 14.166C7.91406 14.3827 7.8224 14.5993 7.6724 14.7577C7.51406 14.9077 7.2974 14.9993 7.08073 14.9993ZM9.9974 14.9993C9.78073 14.9993 9.56406 14.9077 9.40573 14.7577C9.25573 14.5993 9.16406 14.3827 9.16406 14.166C9.16406 14.0577 9.18906 13.9494 9.23073 13.8493C9.2724 13.741 9.33073 13.6494 9.40573 13.5744C9.71406 13.266 10.2807 13.266 10.5891 13.5744C10.6641 13.6494 10.7224 13.741 10.7641 13.8493C10.8057 13.9494 10.8307 14.0577 10.8307 14.166C10.8307 14.3827 10.7391 14.5993 10.5891 14.7577C10.4307 14.9077 10.2141 14.9993 9.9974 14.9993ZM12.9141 14.9993C12.6974 14.9993 12.4807 14.9077 12.3224 14.7577C12.2453 14.6794 12.1856 14.5857 12.1474 14.4827C12.1057 14.3827 12.0807 14.2743 12.0807 14.166C12.0807 14.0577 12.1057 13.9494 12.1474 13.8493C12.1891 13.741 12.2474 13.6494 12.3224 13.5744C12.5141 13.3827 12.8057 13.291 13.0724 13.3493C13.1307 13.3577 13.1807 13.3743 13.2307 13.3993C13.2807 13.416 13.3307 13.441 13.3807 13.4743C13.4224 13.4993 13.4641 13.541 13.5057 13.5744C13.6557 13.7327 13.7474 13.9493 13.7474 14.166C13.7474 14.3827 13.6557 14.5993 13.5057 14.7577C13.3474 14.9077 13.1307 14.9993 12.9141 14.9993ZM17.0807 8.19935H2.91406C2.5724 8.19935 2.28906 7.91602 2.28906 7.57435C2.28906 7.23268 2.5724 6.94935 2.91406 6.94935H17.0807C17.4224 6.94935 17.7057 7.23268 17.7057 7.57435C17.7057 7.91602 17.4224 8.19935 17.0807 8.19935Z"
                      fill="#2EB97E"
                    />
                    <path
                      d="M13.3333 18.9577H6.66667C3.625 18.9577 1.875 17.2077 1.875 14.166V7.08268C1.875 4.04102 3.625 2.29102 6.66667 2.29102H13.3333C16.375 2.29102 18.125 4.04102 18.125 7.08268V14.166C18.125 17.2077 16.375 18.9577 13.3333 18.9577ZM6.66667 3.54102C4.28333 3.54102 3.125 4.69935 3.125 7.08268V14.166C3.125 16.5493 4.28333 17.7077 6.66667 17.7077H13.3333C15.7167 17.7077 16.875 16.5493 16.875 14.166V7.08268C16.875 4.69935 15.7167 3.54102 13.3333 3.54102H6.66667Z"
                      fill="#2EB97E"
                    />
                  </svg>
                  <a href="#0">
                    {" "}
                    {new Date(blog.created_at).toLocaleString("default", {
                      month: "short",
                      day: "2-digit",
                    })}
                  </a>
                </li>
                <li>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_1437_2711)">
                      <path
                        d="M8.05666 18.75H8.05504C7.46832 18.7495 6.91657 18.5207 6.50187 18.1052L0.660341 12.2553C-0.194072 11.3994 -0.194072 10.0065 0.660341 9.15058L8.53478 1.26102C9.3463 0.44792 10.426 0 11.575 0H16.5709C17.7824 0 18.7682 0.985546 18.7682 2.19726V7.17785C18.7682 8.32602 18.3208 9.40532 17.5084 10.2167L9.60951 18.1074C9.19455 18.5218 8.64306 18.75 8.05666 18.75ZM11.575 1.46484C10.8179 1.46484 10.1064 1.75998 9.57163 2.29579L1.69707 10.1853C1.41222 10.4708 1.41222 10.9349 1.69707 11.2203L7.53857 17.0702C7.6767 17.2086 7.86051 17.285 8.05619 17.2851H8.05677C8.1529 17.2854 8.24812 17.2666 8.33694 17.2299C8.42577 17.1931 8.50643 17.1391 8.57427 17.071L16.4732 9.18046C17.0086 8.6458 17.3034 7.93447 17.3034 7.17788V2.19726C17.3034 1.79341 16.9748 1.46484 16.5709 1.46484H11.575ZM13.458 7.43408C12.2465 7.43408 11.2608 6.44853 11.2608 5.23681C11.2608 4.0251 12.2465 3.03955 13.458 3.03955C14.6696 3.03955 15.6553 4.0251 15.6553 5.23681C15.6553 6.44853 14.6696 7.43408 13.458 7.43408ZM13.458 4.50439C13.0542 4.50439 12.7256 4.83296 12.7256 5.23681C12.7256 5.64067 13.0542 5.96924 13.458 5.96924C13.862 5.96924 14.1905 5.64067 14.1905 5.23681C14.1905 4.83296 13.862 4.50439 13.458 4.50439Z"
                        fill="#2EB97E"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_1437_2711">
                        <rect width="20" height="20" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <a href="#0">{blog.category_name}</a>
                </li>
              </ul>
              <div className="blog-detail-html" dangerouslySetInnerHTML={{ __html: blog?.content }}></div>
            </div>
          </div>
          <div className="col-lg-4 order-1 order-lg-2">
            <BlogSideBar />
          </div>
        </div>
      </div>
    </section>
  );
};
export default BlogDetail;
